# Домашнее задание к занятию «3.5 Микросервисы: обеспечение безопасности»

Все задачи этого занятия можно делать в **одном репозитории**.

В качестве результата пришлите ссылки на ваши GitHub-проекты через личный кабинет студента на сайте [netology.ru](https://netology.ru).

**Важно**: если у вас что-то не получилось, то оформляйте Issue [по установленным правилам](../report-requirements.md).

## Как сдавать задачи

1. Создайте на вашем компьютере проект, в котором разместите Go-модули (на основании исходников с лекции).
1. Инициализируйте в нём пустой Git-репозиторий.
1. Добавьте в него готовый файл [.gitignore](../.gitignore).
1. Сделайте необходимые коммиты.
1. Создайте публичный репозиторий на GitHub и свяжите свой локальный репозиторий с удалённым.
1. Сделайте пуш (удостоверьтесь, что ваш код появился на GitHub).
1. Ссылку на ваш проект отправьте в личном кабинете на сайте [netology.ru](https://netology.ru).
1. Задачи, отмеченные как необязательные, можно не сдавать, это не повлияет на получение зачета (в этом ДЗ все задачи являются обязательными).

**Важно**: для выполнения данного ДЗ вам необходимо установить приложение OpenSSL ([пошаговая инструкция по установке](openssl.md)).

## JWT

### Задача

Основываясь на примерах с лекции, реализуйте в ваших сервисах (в минимальном варианте достаточно на auth и backend) генерацию JWT-токенов и авутентификацию с их использованием.

Вы можете использовать как готовую библиотеку (см. на https://jwt.io), так и попробовать написать самостоятельно.

Что нужно сделать:
1. На auth реализовать генерацию токена, в структуре должны быть:
    * `sub`
    * `name`
    * `iat`
    * `exp`
    * `id`
    * `roles`
1. На backend сделать middleware (или на каждом сервере), который валидирует токен (т.е. проверяет подпись и дату истечения), после чего:
    * либо "прокидывает" этот токен в заголовках дальше
    * либо выставляет заголовок, в который кладёт (в любом виде, в котором вам нравится*) ID пользователя и его роли

Примечание*: но лучше делать base64 encode.

Важно: вам не обязательно реализовывать это на полной схеме (с Consul, Kafka, OpenCensus и т.д.). Можете построить простую схему из трёх серверов:
1. auth
1. backend
1. transactions

Для генерации ключей, воспользуйтесь инструкцией по [генерации ключей](keypair.md).

В качестве результата пришлите ссылку на ваш GitHub-проект, в котором реализованы описанные выше требования.

## TLS

### Задача

Основываясь на примерах с лекции, реализуйте в ваших сервисах поддержку TLS.

Вам не обязательно реализовывать это на полной схеме (с Consul, Kafka, OpenCensus и т.д.). Можете построить простую схему из трёх серверов:
1. auth (HTTPS)
1. backend (HTTPS с сертификатом)
1. transactions (gRPC с сертификатом)

Пошаговые инструкции:
* [генерация сертификатов](certificates.md)
* [HTTPS](https.md)
* [gRPC](grpc.md)

В качестве результата пришлите ссылку на ваш GitHub-проект, в котором реализованы описанные выше требования.
